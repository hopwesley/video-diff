package main

import (
	"fmt"
	"math"
)

var DistanceInDescriptor = [3][Cell_M * Cell_m][Cell_M * Cell_m]float64{
	{
		{19.79898987322333, 17.204650534085253, 15.231546211727817, 14.142135623730951, 14.142135623730951, 15.231546211727817, 17.204650534085253, 19.79898987322333},
		{17.204650534085253, 14.142135623730951, 11.661903789690601, 10.198039027185569, 10.198039027185569, 11.661903789690601, 14.142135623730951, 17.204650534085253},
		{15.231546211727817, 11.661903789690601, 8.48528137423857, 6.324555320336759, 6.324555320336759, 8.48528137423857, 11.661903789690601, 15.231546211727817},
		{14.142135623730951, 10.198039027185569, 6.324555320336759, 2.8284271247461903, 2.8284271247461903, 6.324555320336759, 10.198039027185569, 14.142135623730951},
		{14.142135623730951, 10.198039027185569, 6.324555320336759, 2.8284271247461903, 2.8284271247461903, 6.324555320336759, 10.198039027185569, 14.142135623730951},
		{15.231546211727817, 11.661903789690601, 8.48528137423857, 6.324555320336759, 6.324555320336759, 8.48528137423857, 11.661903789690601, 15.231546211727817},
		{17.204650534085253, 14.142135623730951, 11.661903789690601, 10.198039027185569, 10.198039027185569, 11.661903789690601, 14.142135623730951, 17.204650534085253},
		{19.79898987322333, 17.204650534085253, 15.231546211727817, 14.142135623730951, 14.142135623730951, 15.231546211727817, 17.204650534085253, 19.79898987322333},
	},
	{
		{39.59797974644666, 34.40930106817051, 30.463092423455635, 28.284271247461902, 28.284271247461902, 30.463092423455635, 34.40930106817051, 39.59797974644666},
		{34.40930106817051, 28.284271247461902, 23.323807579381203, 20.396078054371138, 20.396078054371138, 23.323807579381203, 28.284271247461902, 34.40930106817051},
		{30.463092423455635, 23.323807579381203, 16.97056274847714, 12.649110640673518, 12.649110640673518, 16.97056274847714, 23.323807579381203, 30.463092423455635},
		{28.284271247461902, 20.396078054371138, 12.649110640673518, 5.656854249492381, 5.656854249492381, 12.649110640673518, 20.396078054371138, 28.284271247461902},
		{28.284271247461902, 20.396078054371138, 12.649110640673518, 5.656854249492381, 5.656854249492381, 12.649110640673518, 20.396078054371138, 28.284271247461902},
		{30.463092423455635, 23.323807579381203, 16.97056274847714, 12.649110640673518, 12.649110640673518, 16.97056274847714, 23.323807579381203, 30.463092423455635},
		{34.40930106817051, 28.284271247461902, 23.323807579381203, 20.396078054371138, 20.396078054371138, 23.323807579381203, 28.284271247461902, 34.40930106817051},
		{39.59797974644666, 34.40930106817051, 30.463092423455635, 28.284271247461902, 28.284271247461902, 30.463092423455635, 34.40930106817051, 39.59797974644666},
	},
	{
		{79.19595949289332, 68.81860213634101, 60.92618484691127, 56.568542494923804, 56.568542494923804, 60.92618484691127, 68.81860213634101, 79.19595949289332},
		{68.81860213634101, 56.568542494923804, 46.647615158762406, 40.792156108742276, 40.792156108742276, 46.647615158762406, 56.568542494923804, 68.81860213634101},
		{60.92618484691127, 46.647615158762406, 33.94112549695428, 25.298221281347036, 25.298221281347036, 33.94112549695428, 46.647615158762406, 60.92618484691127},
		{56.568542494923804, 40.792156108742276, 25.298221281347036, 11.313708498984761, 11.313708498984761, 25.298221281347036, 40.792156108742276, 56.568542494923804},
		{56.568542494923804, 40.792156108742276, 25.298221281347036, 11.313708498984761, 11.313708498984761, 25.298221281347036, 40.792156108742276, 56.568542494923804},
		{60.92618484691127, 46.647615158762406, 33.94112549695428, 25.298221281347036, 25.298221281347036, 33.94112549695428, 46.647615158762406, 60.92618484691127},
		{68.81860213634101, 56.568542494923804, 46.647615158762406, 40.792156108742276, 40.792156108742276, 46.647615158762406, 56.568542494923804, 68.81860213634101},
		{79.19595949289332, 68.81860213634101, 60.92618484691127, 56.568542494923804, 56.568542494923804, 60.92618484691127, 68.81860213634101, 79.19595949289332},
	},
}

var weightedCommon = [][]float64{
	{0.4650431881340563, 0.5609491608144708, 0.635638673826052, 0.676633846161729, 0.676633846161729, 0.635638673826052, 0.5609491608144708, 0.4650431881340563},
	{0.5609491608144708, 0.676633846161729, 0.76672659607082, 0.8161762130223398, 0.8161762130223398, 0.76672659607082, 0.676633846161729, 0.5609491608144708},
	{0.635638673826052, 0.76672659607082, 0.8688150562628432, 0.9248488132162048, 0.9248488132162048, 0.8688150562628432, 0.76672659607082, 0.635638673826052},
	{0.676633846161729, 0.8161762130223398, 0.9248488132162048, 0.9844964370054085, 0.9844964370054085, 0.9248488132162048, 0.8161762130223398, 0.676633846161729},
	{0.676633846161729, 0.8161762130223398, 0.9248488132162048, 0.9844964370054085, 0.9844964370054085, 0.9248488132162048, 0.8161762130223398, 0.676633846161729},
	{0.635638673826052, 0.76672659607082, 0.8688150562628432, 0.9248488132162048, 0.9248488132162048, 0.8688150562628432, 0.76672659607082, 0.635638673826052},
	{0.5609491608144708, 0.676633846161729, 0.76672659607082, 0.8161762130223398, 0.8161762130223398, 0.76672659607082, 0.676633846161729, 0.5609491608144708},
	{0.4650431881340563, 0.5609491608144708, 0.635638673826052, 0.676633846161729, 0.676633846161729, 0.635638673826052, 0.5609491608144708, 0.4650431881340563},
}

var weightedSide32 = [][]float64{
	{7.55581901971196e-86, 5.301718666092324e-65, 4.1863939993042314e-51, 3.720075976020836e-44, 3.720075976020836e-44, 4.1863939993042314e-51, 5.301718666092324e-65, 7.55581901971196e-86},
	{5.301718666092324e-65, 3.720075976020836e-44, 2.9374821117108028e-30, 2.6102790696677047e-23, 2.6102790696677047e-23, 2.9374821117108028e-30, 3.720075976020836e-44, 5.301718666092324e-65},
	{4.1863939993042314e-51, 2.9374821117108028e-30, 2.319522830243569e-16, 2.061153622438558e-9, 2.061153622438558e-9, 2.319522830243569e-16, 2.9374821117108028e-30, 4.1863939993042314e-51},
	{3.720075976020836e-44, 2.6102790696677047e-23, 2.061153622438558e-9, 0.01831563888873418, 0.01831563888873418, 2.061153622438558e-9, 2.6102790696677047e-23, 3.720075976020836e-44},
	{3.720075976020836e-44, 2.6102790696677047e-23, 2.061153622438558e-9, 0.01831563888873418, 0.01831563888873418, 2.061153622438558e-9, 2.6102790696677047e-23, 3.720075976020836e-44},
	{4.1863939993042314e-51, 2.9374821117108028e-30, 2.319522830243569e-16, 2.061153622438558e-9, 2.061153622438558e-9, 2.319522830243569e-16, 2.9374821117108028e-30, 4.1863939993042314e-51},
	{5.301718666092324e-65, 3.720075976020836e-44, 2.9374821117108028e-30, 2.6102790696677047e-23, 2.6102790696677047e-23, 2.9374821117108028e-30, 3.720075976020836e-44, 5.301718666092324e-65},
	{7.55581901971196e-86, 5.301718666092324e-65, 4.1863939993042314e-51, 3.720075976020836e-44, 3.720075976020836e-44, 4.1863939993042314e-51, 5.301718666092324e-65, 7.55581901971196e-86},
}

var weightedSide64 = [][]float64{
	{0, 7.900720773506065e-258, 3.071569856457565e-202, 1.9151695967140057e-174, 1.9151695967140057e-174, 3.071569856457565e-202, 7.900720773506065e-258, 0},
	{7.900720773506065e-258, 1.9151695967140057e-174, 7.445620940050319e-119, 4.642455656042647e-91, 4.642455656042647e-91, 7.445620940050319e-119, 1.9151695967140057e-174, 7.900720773506065e-258},
	{3.071569856457565e-202, 7.445620940050319e-119, 2.8946403116483003e-63, 1.804851387845415e-35, 1.804851387845415e-35, 2.8946403116483003e-63, 7.445620940050319e-119, 3.071569856457565e-202},
	{1.9151695967140057e-174, 4.642455656042647e-91, 1.804851387845415e-35, 1.1253517471925912e-7, 1.1253517471925912e-7, 1.804851387845415e-35, 4.642455656042647e-91, 1.9151695967140057e-174},
	{1.9151695967140057e-174, 4.642455656042647e-91, 1.804851387845415e-35, 1.1253517471925912e-7, 1.1253517471925912e-7, 1.804851387845415e-35, 4.642455656042647e-91, 1.9151695967140057e-174},
	{3.071569856457565e-202, 7.445620940050319e-119, 2.8946403116483003e-63, 1.804851387845415e-35, 1.804851387845415e-35, 2.8946403116483003e-63, 7.445620940050319e-119, 3.071569856457565e-202},
	{7.900720773506065e-258, 1.9151695967140057e-174, 7.445620940050319e-119, 4.642455656042647e-91, 4.642455656042647e-91, 7.445620940050319e-119, 1.9151695967140057e-174, 7.900720773506065e-258},
	{0, 7.900720773506065e-258, 3.071569856457565e-202, 1.9151695967140057e-174, 1.9151695967140057e-174, 3.071569856457565e-202, 7.900720773506065e-258, 0},
}

var weightedSide128 = [][]float64{
	{0, 0, 0, 0, 0, 0, 0, 0},
	{0, 0, 0, 0, 0, 0, 0, 0},
	{0, 0, 7.020667798504735e-251, 1.0611231537463512e-139, 1.0611231537463512e-139, 7.020667798504735e-251, 0, 0},
	{0, 0, 1.0611231537463512e-139, 1.603810890548638e-28, 1.603810890548638e-28, 1.0611231537463512e-139, 0, 0},
	{0, 0, 1.0611231537463512e-139, 1.603810890548638e-28, 1.603810890548638e-28, 1.0611231537463512e-139, 0, 0},
	{0, 0, 7.020667798504735e-251, 1.0611231537463512e-139, 1.0611231537463512e-139, 7.020667798504735e-251, 0, 0},
	{0, 0, 0, 0, 0, 0, 0, 0},
	{0, 0, 0, 0, 0, 0, 0, 0},
}

//var weightsWithDistance = [3][][]float64{
//	{{5.242885663363464e-22, 8.533047625744066e-17, 2.543665647376923e-13, 1.3887943864964021e-11, 1.3887943864964021e-11, 2.543665647376923e-13, 8.533047625744066e-17, 5.242885663363464e-22},
//		{8.533047625744066e-17, 1.3887943864964021e-11, 4.139937718785167e-8, 0.0000022603294069810542, 0.0000022603294069810542, 4.139937718785167e-8, 1.3887943864964021e-11, 8.533047625744066e-17},
//		{2.543665647376923e-13, 4.139937718785167e-8, 0.00012340980408667956, 0.006737946999085467, 0.006737946999085467, 0.00012340980408667956, 4.139937718785167e-8, 2.543665647376923e-13},
//		{1.3887943864964021e-11, 0.0000022603294069810542, 0.006737946999085467, 0.36787944117144233, 0.36787944117144233, 0.006737946999085467, 0.0000022603294069810542, 1.3887943864964021e-11},
//		{1.3887943864964021e-11, 0.0000022603294069810542, 0.006737946999085467, 0.36787944117144233, 0.36787944117144233, 0.006737946999085467, 0.0000022603294069810542, 1.3887943864964021e-11},
//		{2.543665647376923e-13, 4.139937718785167e-8, 0.00012340980408667956, 0.006737946999085467, 0.006737946999085467, 0.00012340980408667956, 4.139937718785167e-8, 2.543665647376923e-13},
//		{8.533047625744066e-17, 1.3887943864964021e-11, 4.139937718785167e-8, 0.0000022603294069810542, 0.0000022603294069810542, 4.139937718785167e-8, 1.3887943864964021e-11, 8.533047625744066e-17},
//		{5.242885663363464e-22, 8.533047625744066e-17, 2.543665647376923e-13, 1.3887943864964021e-11, 1.3887943864964021e-11, 2.543665647376923e-13, 8.533047625744066e-17, 5.242885663363464e-22}},
//	{
//		{7.55581901971196e-86, 5.301718666092324e-65, 4.1863939993042314e-51, 3.720075976020836e-44, 3.720075976020836e-44, 4.1863939993042314e-51, 5.301718666092324e-65, 7.55581901971196e-86},
//		{5.301718666092324e-65, 3.720075976020836e-44, 2.9374821117108028e-30, 2.6102790696677047e-23, 2.6102790696677047e-23, 2.9374821117108028e-30, 3.720075976020836e-44, 5.301718666092324e-65},
//		{4.1863939993042314e-51, 2.9374821117108028e-30, 2.319522830243569e-16, 2.061153622438558e-9, 2.061153622438558e-9, 2.319522830243569e-16, 2.9374821117108028e-30, 4.1863939993042314e-51},
//		{3.720075976020836e-44, 2.6102790696677047e-23, 2.061153622438558e-9, 0.01831563888873418, 0.01831563888873418, 2.061153622438558e-9, 2.6102790696677047e-23, 3.720075976020836e-44},
//		{3.720075976020836e-44, 2.6102790696677047e-23, 2.061153622438558e-9, 0.01831563888873418, 0.01831563888873418, 2.061153622438558e-9, 2.6102790696677047e-23, 3.720075976020836e-44},
//		{4.1863939993042314e-51, 2.9374821117108028e-30, 2.319522830243569e-16, 2.061153622438558e-9, 2.061153622438558e-9, 2.319522830243569e-16, 2.9374821117108028e-30, 4.1863939993042314e-51},
//		{5.301718666092324e-65, 3.720075976020836e-44, 2.9374821117108028e-30, 2.6102790696677047e-23, 2.6102790696677047e-23, 2.9374821117108028e-30, 3.720075976020836e-44, 5.301718666092324e-65},
//		{7.55581901971196e-86, 5.301718666092324e-65, 4.1863939993042314e-51, 3.720075976020836e-44, 3.720075976020836e-44, 4.1863939993042314e-51, 5.301718666092324e-65, 7.55581901971196e-86},
//	},
//	{{0, 7.900720773506065e-258, 3.071569856457565e-202, 1.9151695967140057e-174, 1.9151695967140057e-174, 3.071569856457565e-202, 7.900720773506065e-258, 0}, {7.900720773506065e-258, 1.9151695967140057e-174, 7.445620940050319e-119, 4.642455656042647e-91, 4.642455656042647e-91, 7.445620940050319e-119, 1.9151695967140057e-174, 7.900720773506065e-258}, {3.071569856457565e-202, 7.445620940050319e-119, 2.8946403116483003e-63, 1.804851387845415e-35, 1.804851387845415e-35, 2.8946403116483003e-63, 7.445620940050319e-119, 3.071569856457565e-202}, {1.9151695967140057e-174, 4.642455656042647e-91, 1.804851387845415e-35, 1.1253517471925912e-7, 1.1253517471925912e-7, 1.804851387845415e-35, 4.642455656042647e-91, 1.9151695967140057e-174}, {1.9151695967140057e-174, 4.642455656042647e-91, 1.804851387845415e-35, 1.1253517471925912e-7, 1.1253517471925912e-7, 1.804851387845415e-35, 4.642455656042647e-91, 1.9151695967140057e-174}, {3.071569856457565e-202, 7.445620940050319e-119, 2.8946403116483003e-63, 1.804851387845415e-35, 1.804851387845415e-35, 2.8946403116483003e-63, 7.445620940050319e-119, 3.071569856457565e-202}, {7.900720773506065e-258, 1.9151695967140057e-174, 7.445620940050319e-119, 4.642455656042647e-91, 4.642455656042647e-91, 7.445620940050319e-119, 1.9151695967140057e-174, 7.900720773506065e-258}, {0, 7.900720773506065e-258, 3.071569856457565e-202, 1.9151695967140057e-174, 1.9151695967140057e-174, 3.071569856457565e-202, 7.900720773506065e-258, 0}},
//}

var weightsWithDistance = [3][][]float64{
	{
		{7.55581901971196e-86, 5.301718666092324e-65, 4.1863939993042314e-51, 3.720075976020836e-44, 3.720075976020836e-44, 4.1863939993042314e-51, 5.301718666092324e-65, 7.55581901971196e-86},
		{5.301718666092324e-65, 3.720075976020836e-44, 2.9374821117108028e-30, 2.6102790696677047e-23, 2.6102790696677047e-23, 2.9374821117108028e-30, 3.720075976020836e-44, 5.301718666092324e-65},
		{4.1863939993042314e-51, 2.9374821117108028e-30, 2.319522830243569e-16, 2.061153622438558e-9, 2.061153622438558e-9, 2.319522830243569e-16, 2.9374821117108028e-30, 4.1863939993042314e-51},
		{3.720075976020836e-44, 2.6102790696677047e-23, 2.061153622438558e-9, 0.01831563888873418, 0.01831563888873418, 2.061153622438558e-9, 2.6102790696677047e-23, 3.720075976020836e-44},
		{3.720075976020836e-44, 2.6102790696677047e-23, 2.061153622438558e-9, 0.01831563888873418, 0.01831563888873418, 2.061153622438558e-9, 2.6102790696677047e-23, 3.720075976020836e-44},
		{4.1863939993042314e-51, 2.9374821117108028e-30, 2.319522830243569e-16, 2.061153622438558e-9, 2.061153622438558e-9, 2.319522830243569e-16, 2.9374821117108028e-30, 4.1863939993042314e-51},
		{5.301718666092324e-65, 3.720075976020836e-44, 2.9374821117108028e-30, 2.6102790696677047e-23, 2.6102790696677047e-23, 2.9374821117108028e-30, 3.720075976020836e-44, 5.301718666092324e-65},
		{7.55581901971196e-86, 5.301718666092324e-65, 4.1863939993042314e-51, 3.720075976020836e-44, 3.720075976020836e-44, 4.1863939993042314e-51, 5.301718666092324e-65, 7.55581901971196e-86},
	},
	{
		{0, 7.900720773506065e-258, 3.071569856457565e-202, 1.9151695967140057e-174, 1.9151695967140057e-174, 3.071569856457565e-202, 7.900720773506065e-258, 0},
		{7.900720773506065e-258, 1.9151695967140057e-174, 7.445620940050319e-119, 4.642455656042647e-91, 4.642455656042647e-91, 7.445620940050319e-119, 1.9151695967140057e-174, 7.900720773506065e-258},
		{3.071569856457565e-202, 7.445620940050319e-119, 2.8946403116483003e-63, 1.804851387845415e-35, 1.804851387845415e-35, 2.8946403116483003e-63, 7.445620940050319e-119, 3.071569856457565e-202},
		{1.9151695967140057e-174, 4.642455656042647e-91, 1.804851387845415e-35, 1.1253517471925912e-7, 1.1253517471925912e-7, 1.804851387845415e-35, 4.642455656042647e-91, 1.9151695967140057e-174},
		{1.9151695967140057e-174, 4.642455656042647e-91, 1.804851387845415e-35, 1.1253517471925912e-7, 1.1253517471925912e-7, 1.804851387845415e-35, 4.642455656042647e-91, 1.9151695967140057e-174},
		{3.071569856457565e-202, 7.445620940050319e-119, 2.8946403116483003e-63, 1.804851387845415e-35, 1.804851387845415e-35, 2.8946403116483003e-63, 7.445620940050319e-119, 3.071569856457565e-202},
		{7.900720773506065e-258, 1.9151695967140057e-174, 7.445620940050319e-119, 4.642455656042647e-91, 4.642455656042647e-91, 7.445620940050319e-119, 1.9151695967140057e-174, 7.900720773506065e-258},
		{0, 7.900720773506065e-258, 3.071569856457565e-202, 1.9151695967140057e-174, 1.9151695967140057e-174, 3.071569856457565e-202, 7.900720773506065e-258, 0},
	},
	{
		{0, 0, 0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0, 0, 0},
		{0, 0, 7.020667798504735e-251, 1.0611231537463512e-139, 1.0611231537463512e-139, 7.020667798504735e-251, 0, 0},
		{0, 0, 1.0611231537463512e-139, 1.603810890548638e-28, 1.603810890548638e-28, 1.0611231537463512e-139, 0, 0},
		{0, 0, 1.0611231537463512e-139, 1.603810890548638e-28, 1.603810890548638e-28, 1.0611231537463512e-139, 0, 0},
		{0, 0, 7.020667798504735e-251, 1.0611231537463512e-139, 1.0611231537463512e-139, 7.020667798504735e-251, 0, 0},
		{0, 0, 0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0, 0, 0},
	},
}

// calculateDistances 计算距离和权重距离
func calculateDistances(S, M, m int, sigma float64) ([][]float64, [][]float64) {
	distances := make([][]float64, M*m)
	weightedDistances := make([][]float64, M*m)
	for i := range distances {
		distances[i] = make([]float64, M*m)
		weightedDistances[i] = make([]float64, M*m)
	}

	centerX := float64(S) / 2
	centerY := float64(S) / 2
	blockSize := float64(S) / float64(M*m)
	center := Point{X: centerX, Y: centerY}

	for i := 0; i < M*m; i++ {
		for j := 0; j < M*m; j++ {
			blockTopLeftX := float64(j) * blockSize
			blockTopLeftY := float64(i) * blockSize

			blockCenterX := blockTopLeftX + blockSize/2
			blockCenterY := blockTopLeftY + blockSize/2
			blockCenter := Point{X: blockCenterX, Y: blockCenterY}

			distance := math.Sqrt(math.Pow(centerX-blockCenterX, 2) + math.Pow(centerY-blockCenterY, 2))
			distances[i][j] = distance

			weightedDistance := GaussianKernel2D(blockCenter, center, sigma)
			fmt.Println(blockCenter, center, weightedDistance)
			weightedDistances[i][j] = weightedDistance
		}
	}
	saveJson(fmt.Sprintf("tmp/ios/desc_distances_%d.json", S), distances)
	saveJson(fmt.Sprintf("tmp/ios/desc_weighted_%d.json", S), weightedDistances)
	return distances, weightedDistances
}
